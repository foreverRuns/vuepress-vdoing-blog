---
title: å½»åº•ç†è§£å’ŒæŒæ¡ KMP ç®—æ³•
date: 2022-04-08 13:56:01
permalink: /pages/ec9631/
categories:
  - ç®—æ³•
tags:
  - KMP
---

æœ¬æ–‡å¸¦ä½ å½»åº•ç†è§£å’ŒæŒæ¡ KMP(Knuth-Morris-Pratt) ç®—æ³•

> LeetCodeï¼š[https://leetcode-cn.com/problems/implement-strstr](https://leetcode-cn.com/problems/implement-strstr)

## BF(Brute Force) ç®—æ³• / æš´åŠ›ç®—æ³•

* æ–‡æœ¬ä¸² Text: `ababababca`
* æ¨¡å¼ä¸² Pattern: `abababca`

![KMP-1](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-1.7fqmvakk5x8.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä» Tä¸² çš„èµ·å§‹ä½ å’Œ Pä¸² å¾ªç¯åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…æˆåŠŸè¿”å›å¯¹åº”çš„ä¸‹æ ‡ æˆ–è€…åŒ¹é…åˆ°æœ€åç»“æŸè¿”å›-1

<code-group>
  <code-block title="js" active>

  ```js
  function strStr(t, p) {
    for (let i = 0; i <= t.length-p.length; i++) {
      let flag = true;
      for (let j = 0; j < p.length; j++) {
        if (t[i + j] != p[j]) {
            flag = false;
            break;
        }
      }
      if (flag) {
        return i;
      }
    }
    return -1;
  }
  ```
  </code-block>

  <code-block title="c">

  ```c
  int strStr(char* t, char* p) 
  {
    int i = 0, j = 0;
    bool flag = true;

    for (i = 0; i <= strlen(t)-strlen(p); i++) 
    {
      for (j = 0; j < strlen(p); j++) 
      {
        if (t[i + j] != p[j]) 
        {
            flag = false;
            break;
        }
      }

      if (flag) 
        return i;
    }

    return -1;
  }
  ```
  </code-block>
</code-group>

## KMP(Knuth Morris Pratt) ç®—æ³•

### åŸç†åˆ¨æ

é«˜æ€§èƒ½çš„ç®—æ³•éƒ½æ˜¯æ…¢æ…¢ä¼˜åŒ–å‡ºæ¥çš„ï¼Œä»ä¸Šé¢çš„æš´åŠ›ç®—æ³•æ¥çœ‹ï¼Œç¬¬ 1 è½®å¦‚ä¸‹ï¼š

![KMP-2](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-2.2te6b8ovjkw0.png)

ç¬¬ 2ã€3 è½®å¦‚ä¸‹ï¼š

![KMP-3](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-3.5m255co1zbeo.png)

> ä¸Šå›¾ä¸­ `æ‹¬å·` ã€`çº¢è‰²` çš„å†…å®¹çœ‹ä¸æ‡‚å…ˆä¸ç®¡ï¼Œåé¢ç†è§£äº†å›å¤´çœ‹å°±æ‡‚äº†

ç¬¬ 2 è½® T[1] != P[0] ç›´æ¥å¤±è´¥ï¼Œè¿›å…¥ç¬¬ä¸‰è½®

ç¬¬ 3 è½® T[2-5] == P[0-3]ï¼Œè¿›å…¥ T[i=6] è·Ÿ P[j=4] çš„åˆ¤æ–­

> KMT ç®—æ³•å°±æ˜¯èƒ½å¤Ÿç›´æ¥ä»ç¬¬ 1 è½®åŒ¹é…å¤±è´¥æ—¶çš„ i=6ï¼Œè¿›å…¥åˆ° ç¬¬ 3 è½®çš„ T[i=6] è·Ÿ P[j=4] çš„åˆ¤æ–­ï¼Œç›´æ¥è·³è¿‡ä¸­é—´èƒ½å¤Ÿç¡®å®šå¤±è´¥çš„æ¯”è¾ƒï¼Œé‡ç‚¹å°±æ˜¯æ€ä¹ˆå»ç¡®å®šä¸­é—´è¿™äº›æ¯”è¾ƒä¸€å®šæ˜¯å¤±è´¥çš„

ç»§ç»­ä¸Šé¢ï¼Œå‡å¦‚Tä¸²æ¯”è¾ƒé•¿ï¼Œä¸Šé¢ç¬¬ä¸‰è½®è¿˜æœªæˆåŠŸï¼ŒæŒ‰æš´åŠ›BFç®—æ³•ç»§ç»­ä¸‹å»å°±æ˜¯ i=3 ç„¶å j=0ï¼Œæ ¹æ®ä¸Šå›¾ï¼Œ `P ä¸²å³ç§»ä¸€ä½ï¼Œå³ j=0 å¯¹é½åˆ° i=3` è‡ªè¡Œè„‘è¡¥ä¸€ä¸‹ :smile: ï¼Œè¿™æ—¶å›¾ä¸­ `æ·±ç°è‰²ä¸²` ä¸Šä¸‹éœ€è¦æ¯”è¾ƒçš„å°±åªæœ‰ä¸‰ä¸ª

ç„¶åä¸€ç›´åŒ¹é…å¤±è´¥ï¼ŒBFå¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æ·±ç°è‰²éƒ¨åˆ†é”™å¼€ï¼Œå³ç¬¬ 7 è½® æ—¶ `(æ³¨æ„æ­¤æ—¶ i ç›¸å¯¹äºç¬¬ä¸€è½®åŒ¹é…å¤±è´¥æ—¶çš„ä½ç½®ä»å›¾ç‰‡ä¸Šæ¥è¯´ä¹Ÿæ˜¯ä¸åŠ¨çš„ï¼Œåªä¸è¿‡æ­¤æ—¶ i=6 è¡¨ç¤ºçš„æ˜¯BFç¬¬7è½®)` 

> **<kbd>é‡</kbd> <kbd>ç‚¹</kbd> <kbd>æ¥</kbd> <kbd>äº†</kbd>**

:::tip
å‰ç¼€å°±æ˜¯é™¤äº†æœ€åä¸€ä½ï¼Œä»ç¬¬ä¸€ä½åˆ°ä»»æ„ä¸€ä½çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ä¸Šé¢çš„ `ababab` çš„å‰ç¼€å°±åŒ…æ‹¬ `ababa` `abab` `aba`  `ab` `a`  
åç¼€å°±æ˜¯é™¤äº†ç¬¬ä¸€ä½ï¼Œä»ä»»æ„ä¸€ä½åˆ°æœ€åä¸€ä½çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ä¸Šé¢çš„ `ababab` çš„åç¼€å°±åŒ…æ‹¬ `babab` `abab` `bab`  `ab` `b`  
> æ³¨æ„ï¼šæœ¬èº«ä¸æ˜¯åç¼€ä¹Ÿä¸æ˜¯å‰ç¼€
:::
 
**è¿™æ—¶ä½ ä¼šå‘ç°ï¼Œåœ¨æ·±ç°è‰²éƒ¨åˆ†é”™å¼€ä¹‹å‰çš„è¿™å‡ è½®ä¸­ï¼Œå‰é¢æ·±ç°è‰²éƒ¨åˆ†çš„æ¯”è¾ƒ:**

* **å°±æ˜¯ ç¬¬ 1 è½®åŒ¹é…å¤±è´¥æ—¶ å‰é¢ç›¸åŒå­—ä¸²(`ababab`) çš„ `å‰ç¼€è·Ÿåç¼€` åœ¨æ¯”è¾ƒï¼Œå¹¶ä¸”æ˜¯ä»`æœ€é•¿å‰åç¼€`å¾€æœ€çŸ­çš„å»æ¯”è¾ƒï¼ˆè„‘è¡¥ä¸€ä¸‹ï¼Œä¸€ç›´åœ¨é”™å¼€ï¼Œæ‰€ä»¥æ˜¯ä»æœ€é•¿åˆ°æœ€çŸ­ï¼‰**

* **ä¹Ÿæ˜¯ Tä¸² è·Ÿ Pä¸² `å¼€å§‹ä¸€éƒ¨åˆ†`çš„æ¯”è¾ƒï¼Œæ‰€ä»¥åªè¦å‰åç¼€ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸€è½®å°± `ç¡®å®šæ˜¯å¤±è´¥çš„`** 
  
> **è¿™æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š**

* **æ²¡æœ‰ç›¸åŒçš„å‰åç¼€ï¼Œä¹Ÿå°±æ˜¯æ·±ç°è‰²éƒ¨åˆ†æœ€ç»ˆé”™å¼€ï¼Œè¿™æ—¶ j=0ã€i=6ï¼ˆä¹Ÿå°±æ˜¯è¿›å…¥BFçš„ç¬¬ä¸ƒè½®çš„æ¯”è¾ƒï¼‰ï¼Œç»§ç»­åé¢çš„æ¯”è¾ƒ**
  
* **æœ‰ç›¸åŒçš„å‰åç¼€(æ³¨æ„è¿™ä¸ªä¹Ÿæ˜¯æœ€é•¿ç›¸åŒå‰åç¼€)ï¼Œè¿™æ—¶ä¹Ÿå°±æ˜¯ä¸Šé¢å›¾ç‰‡BFç¬¬ä¸‰è½®çš„æƒ…å†µï¼Œç”±äºå‰åç¼€ç›¸åŒï¼Œä¹Ÿå°±æ˜¯ Tä¸² è·Ÿ Pä¸² å¼€å§‹çš„éƒ¨åˆ†ç›¸åŒï¼Œæ— éœ€å†æ¯”è¾ƒ**
  **j æŒ‡å‘ç›¸åŒå‰åç¼€çš„åä¸€ä½ï¼Œä¸‹æ ‡ä»0å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ç­‰äº`æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦` ï¼Œæ‰€ä»¥ j=4ã€i=6 (æ³¨æ„è¿™é‡Œç›¸å½“äºBFç¬¬ä¸‰è½®çš„ T[i=6] è·Ÿ P[j=4] çš„æ¯”è¾ƒ)ï¼Œç»§ç»­åé¢çš„æ¯”è¾ƒ**

> **ç»§ç»­åé¢çš„æ¯”è¾ƒ**ï¼š

  - **æˆåŠŸï¼Œè¾“å‡ºå¯¹åº”çš„ä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯ `i å‡å» P ä¸²é•¿åº¦ + 1` æˆ–è€… `i - j`**
  
  - **å¤±è´¥ï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯æ±‚å‡ºå¤±è´¥ä½ç½®å‰é¢ç›¸åŒéƒ¨åˆ†çš„ `æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦`ï¼Œç„¶å `j ç§»åŠ¨åˆ°è¯¥ä½ç½®ï¼Œi ä¿æŒå¤±è´¥æ—¶çš„ä½ç½®ä¸å˜`ï¼Œç»§ç»­åé¢çš„æ¯”è¾ƒï¼Œç„¶åé‡å¤ä¸‹å»**


:::note åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥æ¸…æ¥š KMP ä¸ºä»€ä¹ˆç›¸æ¯”äºBFæš´åŠ›è§£æ³•æ›´å¿«ï¼š

  * **å› ä¸º KMP åˆ©ç”¨å·²åŒ¹é…éƒ¨åˆ†ä¸­æœ€é•¿ç›¸åŒçš„ã€Œå‰ç¼€ã€å’Œã€Œåç¼€ã€æ¥è·³è¿‡é‚£äº›èƒ½å¤Ÿè¢«å¦å®šçš„åŒ¹é…ã€‚**

  * **å› ä¸º KMP çš„åŸä¸²æŒ‡é’ˆ i ä¸ä¼šè¿›è¡Œå›æº¯ï¼Œè¦ä¹ˆé€’å¢ï¼Œè¦ä¹ˆä¿æŒåŸä½ã€‚ï¼ˆj=0ï¼Œä¹Ÿå°±æ˜¯Pä¸²ä»å¼€å§‹ä½ç½®æ¯”è¾ƒæ—¶ï¼Œiã€j æ˜¯é€’å¢ç›´åˆ°åŒ¹é…å¤±è´¥åœä¸‹æ¥ï¼Œæ¥ä¸‹æ¥ i ä¿æŒä½ç½®ä¸å˜ï¼Œj è·³åˆ°ç›¸åŒæœ€é•¿å‰åç¼€é•¿åº¦çš„ä½ç½®ç»§ç»­åé¢çš„æ¯”è¾ƒ ï¼‰**
:::


> **<kbd>é‡</kbd> <kbd>ç‚¹</kbd> <kbd>åˆ</kbd> <kbd>æ¥</kbd> <kbd>äº†</kbd>**

é€šè¿‡ä¸Šé¢ï¼Œæˆ‘ä»¬çŸ¥é“ Pä¸² ä»å¼€å§‹ä½ç½®(j = 0 )åˆ°åŒ¹é…å¤±è´¥æ—¶çš„ä½ç½® `å‰é¢éƒ¨åˆ†è·Ÿ Tä¸² æ˜¯ç›¸åŒçš„`ï¼Œä¹Ÿå°±æ˜¯è¯´ **å¯¹äºåŒ¹é…ä¸² P çš„ä»»æ„ä¸€ä¸ªå¤±è´¥ä½è€Œè¨€ï¼Œç”±è¯¥ä½ç½®å‘èµ·çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç‚¹ä½ç½®(j è·³è½¬çš„ä½ç½®)å…¶å®ä¸åŸä¸²æ— å…³(å‰é¢éƒ¨åˆ†ç›¸åŒäº†ä¹Ÿå°±ä¸éœ€è¦åŸä¸²äº†)ã€‚**

ä¸¾ä¸ªğŸŒ°ï¼Œå¯¹äº Pä¸² `abcabd ` çš„å­—ç¬¦ `d`(è¯¥ä½ç½®åŒ¹é…å¤±è´¥) è€Œè¨€ï¼Œå‰é¢ç›¸åŒéƒ¨åˆ† `abcab` çš„ `æœ€é•¿ç›¸åŒå‰åç¼€ ab` çš„ é•¿åº¦ä¸º 2ï¼Œä¹Ÿå°±æ˜¯è¯´ç”±å­—ç¬¦ `d` å‘èµ·çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç‚¹ä½ç½®(j è·³è½¬çš„ä½ç½®)å¿…ç„¶æ˜¯å­—ç¬¦ `c` çš„ä½ç½®ï¼ˆ2 çš„ä½ç½®ï¼‰

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å…ˆæ±‚å‡º Pä¸² åœ¨æ¯ä¸ªä½ç½®å¤±è´¥æ—¶å‰é¢éƒ¨åˆ†å¯¹åº”çš„ `æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦`ï¼Œç»„æˆä¸€ä¸ª `next` æ•°ç»„ï¼Œæˆ‘ä»¬å°†è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæ‰¾ `next` ç‚¹ã€‚

![KMP-4](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-4.5cut7vyk6m0w.png)

:::note ğŸ‘‰
**åˆ°è¿™é‡Œä½ åº”è¯¥æ˜ç™½ï¼Œä¸ºä»€ä¹ˆ KMP ç®—æ³•ä¸­éœ€è¦å…ˆè®¾ç½®ä¸€ä¸ª `next` æ•°ç»„ï¼Œä¿å­˜ç€ `åŒ¹é…ä¸²P` åœ¨æ¯ä¸ªä½ç½®å‰é¢éƒ¨åˆ†å¯¹åº”çš„ `æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦` äº†å§ï¼ï¼ï¼**
:::

å…ˆçœ‹çœ‹åœ¨ç¡®å®š `next æ•°ç»„` æƒ…å†µä¸‹çš„æ ¸å¿ƒä»£ç ï¼š

<code-group>
  <code-block title="js" active>

  ```js
  function strStr(t, p) {
    let i = 0, j = 0;

    // p ä¸ºç©ºæ—¶ ç›´æ¥è¿”å› 0ï¼Œä¸ js ä¸­çš„ str.indexOf('') è¿”å› 0 ç›¸åŒ
    if(p.length === 0) {
      return 0
    }

    // j == p.length æ—¶ï¼Œè¯´æ˜åŒ¹é…ä¸Šäº†ï¼Œé€€å‡ºå¾ªç¯
    // i == t.length æ—¶ï¼Œè¯´æ˜å‰ä¸€è½®å·²ç»åŒ¹é…åˆ° Tä¸² æœ€åä¸€ä½äº†ï¼Œè¿™ä¸€è½®éœ€è¦é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™è¶Šç•Œäº†
    while(i < t.length && j < p.length) {
      // 1. 
      // æ³¨æ„ï¼šnext æ•°ç»„çš„ç¬¬ä¸€ä½æˆ‘ä»¬è®¾ç½®ä¸º -1ï¼Œå³ next[0] = -1;
      // j == -1 è¯´æ˜ ä¸Šä¸€è½®å¾ªç¯ä¸­ j = next[j] = next[0]ï¼Œj = 0ï¼Œè¡¨ç¤ºçš„å…¶å®å°±æ˜¯ä¸Šä¸€è½®å¾ªç¯ä¸­ï¼Œåœ¨ Pä¸² çš„èµ·å§‹ä½å°±åŒ¹é…å¤±è´¥äº†
      // è¿™ä¸€è½®å¾ªç¯ i æŒ‡å‘ä¸‹ä¸€ä½ï¼Œå³ i++ï¼Œè€Œ j éœ€è¦æŒ‡å‘èµ·å§‹ä½ï¼Œå³ j = 0ï¼Œj == -1 æ—¶ j++ åˆšå¥½å°±æ˜¯ 0 æŒ‡å‘èµ·å§‹ä½
      // 2. 
      // t[i] == p[j] è¯´æ˜è¯¥ä½åŒ¹é…ä¸Šï¼Œç»§ç»­ä¸‹ä¸€ä½çš„åŒ¹é…ï¼Œæ‰€ä»¥ i++; j++;
      if (j == -1 || t[i] == p[j]) 
      {
        i++;
        j++;
      } else {
        // æ²¡åŒ¹é…ä¸Šï¼Œj æŒ‡å‘ è¯¥ä½å‰é¢å·²åŒ¹é…çš„å­—ä¸² æœ€é•¿ç›¸åŒå‰åç¼€ çš„åé¢ï¼Œå³ ç­‰äºæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ next[j]
        j = next[j];
      }
    }

    // åŒ¹é…åˆ°ï¼Œè¿”å›å¯¹åº”çš„ä¸‹æ ‡
    if (j === p.length)
        return i - j;

    return -1; 
  }
  ```
  </code-block>

  <code-block title="C">

  ```c
  int strStr(char *t, char *p) 
  {
    int i = 0, j = 0;
    // strlen è¿”å›å€¼æ˜¯ unsigned int éœ€è¦è½¬åŒ–ä¸º intï¼Œå¦åˆ™ä¸‹é¢ j < m çš„åˆ¤æ–­ å½“ j = -1 æ—¶ä¼šè·³å‡ºå¾ªç¯å‡ºé”™
    int n = (int)strlen(t), m = (int)strlen(p);

    if(m == 0) 
    {
      return 0;
    }

    while(i < n && j < m) 
    {
      if (j == -1 || t[i] == p[j]) 
      {
        i++;
        j++;
      } 
      else 
      {
        j = next[j];
      }
    }

    if (j == m)
        return i - j;

    return -1;
  }
  ```
  </code-block>
</code-group>

### next æ•°ç»„çš„æ„å»º

é€šè¿‡ä¸Šé¢åŸç†å‰–æï¼Œæˆ‘ä»¬çŸ¥é“ï¼š

* **å¯¹äºåŒ¹é…ä¸² P çš„ä»»æ„ä¸€ä¸ªå¤±è´¥ä½è€Œè¨€ï¼Œç”±è¯¥ä½ç½®å‘èµ·çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç‚¹ä½ç½® (j è·³è½¬çš„ä½ç½®) å…¶å®ä¸åŸä¸²æ— å…³ã€‚**

* **`è·³è½¬çš„ä½ç½®` å°±æ˜¯ `Pä¸²` åœ¨ `å¤±è´¥ä½` å‰é¢å­—ä¸²çš„ `æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦`ã€‚**

![KMP-4](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-4.5cut7vyk6m0w.png)

**å°† `Pä¸²` æ¯ä¸ªä½ç½® å‰é¢å­—ä¸²çš„ `æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦` æ‰¾å‡ºæ¥ç»„æˆä¸€ä¸ª `next` æ•°ç»„ï¼Œæˆ‘ä»¬å°†è¿™ä¸€è¿‡ç¨‹ç§°ä¸º `next æ•°ç»„çš„æ„å»º`ã€‚**


#### next æ•°ç»„æ„å»ºè¿‡ç¨‹

**æ±‚ next æ•°ç»„çš„è¿‡ç¨‹å®Œå…¨å¯ä»¥çœ‹æˆå­—ç¬¦ä¸²åŒ¹é…çš„è¿‡ç¨‹ï¼Œå³ä»¥æ¨¡å¼å­—ç¬¦ä¸²ä¸ºä¸»å­—ç¬¦ä¸²ï¼Œä»¥æ¨¡å¼å­—ç¬¦ä¸²çš„å‰ç¼€ä¸ºç›®æ ‡å­—ç¬¦ä¸²ã€‚**

![KMP-5](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-5.al2l8el85x4.png)

`next[0] = -1` : æ–¹ä¾¿åé¢ç¼–ç è‡ªå¢ç­‰äº 0ï¼ŒæŒ‡å‘èµ·å§‹ä½

`next[1] = 0` : è¿™ä¸ªä½ç½®å‰é¢åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œæ²¡æœ‰å‰åç¼€ï¼Œæ‰€ä»¥ä¸º 0

`next[2]` : è¿™ä¸ªä½ç½®å‰åç¼€å°±åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œ


![KMP-6](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-6.6elt84pisuf4.png)

`next[3]` : è¿™ä¸ªä½ç½®æœ€é•¿çš„å‰åç¼€é•¿åº¦ä¸º 2 ï¼Œæ ¹æ®ä¸Šä¸€è½®çŸ¥é“é•¿åº¦ä¸º 2 æ˜¯ä¸ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯åªéœ€æ¯”è¾ƒæœ€åä¸€ä½é•¿åº¦ä¸º 1 çš„å‰åç¼€æ˜¯å¦ç›¸åŒã€‚

            
![KMP-7](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-7.18obs5xsud9c.png)

`next[4]` ã€`next[5]` ã€`next[6]` ï¼šç”±äºå‰é¢ j ä½éƒ½æ˜¯åŒ¹é…ä¸Šçš„ï¼Œå¦‚æœè¾ƒæœ€åä¸€ä½ä¹Ÿç›¸ç­‰ï¼Œæ­¤æ—¶ j + 1 å°±æ˜¯æœ€é•¿å‰åç¼€äº†ï¼Œå¦‚æœä¸ç›¸ç­‰(ä¸‹è½®çš„æƒ…å†µ)


![KMP-8](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-8.z3lrtz0pssw.png)

![KMP-9](https://cdn.jsdelivr.net/gh/foreverRuns/image-hosting@main/blog/KMP-9.4oy4ykdxt8cg.png)

ä¸ç›¸ç­‰ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æŸ¥çœ‹å‰é¢æ˜¯å¦è¿˜æœ‰å…¶ä»–æ›´çŸ­çš„ç›¸åŒå‰åç¼€ï¼Œè¿™ä¸ªæ—¶å€™ä»å“ªé‡Œå¼€å§‹çœ‹ï¼Œ**`è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æ˜¯å°±æ˜¯ KMP åŒ¹é…åˆ°å¤±è´¥æ—¶ï¼Œçœ‹å‰é¢å­—ä¸²çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ï¼Œç„¶åå»è·³è½¬ j`**

å¹¶ä¸” **`æ­¤æ—¶å‰é¢æ¯ä¸ªä½ç½®çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦æˆ‘ä»¬å·²ç»æ±‚å‡ºæ¥äº†ï¼Œå°±æ˜¯å·²ç»ç®—å‡ºçš„ nextæ•°ç»„çš„å‰éƒ¨åˆ†`**ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹è·Ÿ KMP æŸ¥æ‰¾å­—ä¸²ç›¸é€šçš„ï¼Œä¹Ÿå°±å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š

:::note next æ•°ç»„æ„å»ºè¿‡ç¨‹
**æ±‚ next æ•°ç»„çš„è¿‡ç¨‹å®Œå…¨å¯ä»¥çœ‹æˆå­—ç¬¦ä¸²åŒ¹é…çš„è¿‡ç¨‹ï¼Œå³ä»¥æ¨¡å¼å­—ç¬¦ä¸²ä¸ºä¸»å­—ç¬¦ä¸²ï¼Œä»¥æ¨¡å¼å­—ç¬¦ä¸²çš„å‰ç¼€ä¸ºç›®æ ‡å­—ç¬¦ä¸²ã€‚** 

 > **åŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆå½“å‰çš„ next å€¼å°±æ˜¯åŒ¹é…æˆåŠŸçš„å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ å³ next[++i] = ++j;**  

 > **åŒ¹é…å¤±è´¥ï¼Œæ ¹æ®å‰é¢æ±‚å‡ºçš„ next å€¼å»è·³è½¬ï¼Œå³ j = next[j];**
:::

ä¸‹é¢ç»™å‡ºå…·ä½“ä»£ç ï¼š

<code-group>
  <code-block title="js" active>

  ```js
  function getNext(p, next) {
    let i = 1, j = 0;

    next[0] = -1;
    next[1] = 0;

    while (i < p.length - 1) {
      if (j == -1 || p[i] == p[j]) {
        i++;
        j++;
        next[i] = j;
      }	else {
        j = next[j];
      }	
    }
  }
  ```
  </code-block>

  <code-block title="c">

  ```c
  void getNext(char* p, int* next)
  {
    int i = 1, j = 0;

    next[0] = -1;
    next[1] = 0;

    while (i < (int)strlen(p) - 1)
    {
      if (j == -1 || p[i] == p[j])
      {
        i++;
        j++;
        next[i] = j;
      }	
      else
      {
        j = next[j];
      }	
    }
  }
  ```
  </code-block>
</code-group>

### ä»£ç å®ç°

æ•´ä½“ä»£ç åˆå¹¶åå¦‚ä¸‹ï¼š

<code-group>
  <code-block title="js" active>

  ```js
  function strStr(t, p) {
    const pl = p.length;
    
    // p ä¸ºç©ºæ—¶ ç›´æ¥è¿”å› 0ï¼Œä¸ js ä¸­çš„ str.indexOf('') è¿”å› 0 ç›¸åŒ
    if(pl === 0) {
      return 0
    }

    //const next = new Array(pl).fill(0);
    const next = [];

    // æ„å»º next æ•°ç»„
    next[0] = -1;
    if(pl > 1) {
      next[1] = 0;
    }

    let i = 1, j = 0;

    while (i < p.length - 1) {
      if (j == -1 || p[i] == p[j]) {
        i++;
        j++;
        next[i] = j;
      }	else {
        j = next[j];
      }	
    }

    // KMP
    i = 0;
    j = 0;
    // j == p.length æ—¶ï¼Œè¯´æ˜åŒ¹é…ä¸Šäº†ï¼Œé€€å‡ºå¾ªç¯
    // i == t.length æ—¶ï¼Œè¯´æ˜å‰ä¸€è½®å·²ç»åŒ¹é…åˆ° Tä¸² æœ€åä¸€ä½äº†ï¼Œè¿™ä¸€è½®éœ€è¦é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™è¶Šç•Œäº†
    while(i < t.length && j < p.length) {
      // 1. 
      // æ³¨æ„ï¼šnext æ•°ç»„çš„ç¬¬ä¸€ä½æˆ‘ä»¬è®¾ç½®ä¸º -1ï¼Œå³ next[0] = -1;
      // j == -1 è¯´æ˜ ä¸Šä¸€è½®å¾ªç¯ä¸­ j = next[j] = next[0]ï¼Œj = 0ï¼Œè¡¨ç¤ºçš„å…¶å®å°±æ˜¯ä¸Šä¸€è½®å¾ªç¯ä¸­ï¼Œåœ¨ Pä¸² çš„èµ·å§‹ä½å°±åŒ¹é…å¤±è´¥äº†
      // è¿™ä¸€è½®å¾ªç¯ i æŒ‡å‘ä¸‹ä¸€ä½ï¼Œå³ i++ï¼Œè€Œ j éœ€è¦æŒ‡å‘èµ·å§‹ä½ï¼Œå³ j = 0ï¼Œj == -1 æ—¶ j++ åˆšå¥½å°±æ˜¯ 0 æŒ‡å‘èµ·å§‹ä½
      // 2. 
      // t[i] == p[j] è¯´æ˜è¯¥ä½åŒ¹é…ä¸Šï¼Œç»§ç»­ä¸‹ä¸€ä½çš„åŒ¹é…ï¼Œæ‰€ä»¥ i++; j++;
      if (j == -1 || t[i] == p[j]) 
      {
        i++;
        j++;
      } else {
        // æ²¡åŒ¹é…ä¸Šï¼Œj æŒ‡å‘ è¯¥ä½å‰é¢å·²åŒ¹é…çš„å­—ä¸² æœ€é•¿ç›¸åŒå‰åç¼€ çš„åé¢ï¼Œå³ ç­‰äºæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ next[j]
        j = next[j];
      }
    }

    // åŒ¹é…åˆ°ï¼Œè¿”å›å¯¹åº”çš„ä¸‹æ ‡
    if (j === p.length)
        return i - j;
   
    return -1; 
  }
  ```
  </code-block>

  <code-block title="C">

  ```c
  int strStr(char *t, char *p) 
  {
    int i = 1, j = 0;
    // strlen è¿”å›å€¼æ˜¯ unsigned int éœ€è¦è½¬åŒ–ä¸º intï¼Œå¦åˆ™ä¸‹é¢ j < m çš„åˆ¤æ–­ å½“ j = -1 æ—¶ä¼šè·³å‡ºå¾ªç¯å‡ºé”™
    int n = (int)strlen(t), m = (int)strlen(p);
    //int *next = (int*)malloc(sizeof(int) * m);

    if(m == 0) 
    {
      return 0;
    }

    // æ„å»º next æ•°ç»„
    // int next[m] = {0};
    int next[m];

    next[0] = -1;
    if (m > 1) {
        next[1] = 0;
    }

    while (i < (int)strlen(p) - 1)
    {
      if (j == -1 || p[i] == p[j])
      {
        i++;
        j++;
        next[i] = j;
      }	
      else
      {
        j = next[j];
      }	
    }

    // kMP
    i = 0;
    j = 0;

    while(i < n && j < m) 
    {
      if (j == -1 || t[i] == p[j]) 
      {
        i++;
        j++;
      } 
      else 
      {
        j = next[j];
      }
    }

    if (j == m)
        return i - j;
    
    return -1;
  }
  ```
  </code-block>
</code-group>